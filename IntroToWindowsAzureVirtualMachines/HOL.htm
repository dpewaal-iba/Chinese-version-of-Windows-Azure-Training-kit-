<!DOCTYPE html>

<html class="no-js" lang="en" class="js flexbox canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head id="ContentPlaceHolderDefault_Head1">
    <meta http-equiv="X-UA-Compatible" content="IE=9,chrome=1" />
    <meta charset=UTF-8" />
    <title>Windows Azure 培训包 - Windows Azure 虚拟机简介</title>
    <link rel="Stylesheet" type="text/css" media="all" href="styles/master.css" />
</head>
<body id="top" class="page-">
    <div id="page">
        <div id="wrapper" class="landingPage getStartedPage">            
            <div class="header">								
				<img alt="Windows Azure" src="images/azure-logo.png" /> <span class="mainHomepageSubTitle">培训包 - 2012 年 12 月更新</span>								
			</div>			
			<div class="nav-menu-header">
				<nav>
					<ul>
						<li class="MenuLink-Selected">
							<a href="#">内容</a>
						</li>
												<li class="MenuLink">
							<a href="Source">设置</a>
						</li>
											</ul>
				
										
						<span id="github-btn" class="github-btn"> <a id="gh-btn" title="在 GitHub 中复制此存储库的分支" href="https://github.com/WindowsAzure-TrainingKit/HOL-IntroToWindowsAzureVirtualMachines" target="_blank" class="gh-btn"> <span class="gh-ico"></span> <span id="gh-text" class="gh-text">分支</span> </a> </span> <span id="github-btn" class="github-btn github-watchers"> <a id="gh-btn" title="在 GitHub 中关注此存储库" href="https://github.com/WindowsAzure-TrainingKit/HOL-IntroToWindowsAzureVirtualMachines" target="_blank" class="gh-btn"> <span class="gh-ico"></span> <span id="gh-text" class="gh-text">关注</span> </a> </span>
						
									
				</nav>
			</div>	        
		</span>
			<div id="content" class="textpage">
            <section id="content-container">
				<div id="content" class="textpage">
			    <a name="top"></a>
				
				

		<div class="content">
			<?xml version="1.0" encoding="iso-8859-1"?><span><p><a name="HOLTop"></a></p>

<h1 id="Introduction_to_Windows_Azure_Virtual_Machines">Windows Azure 虚拟机简介</h1>

<hr />

<p><a name="Overview"></a></p>

<h2 id="Overview">概述</h2>

<p>使用 Windows Azure 作为 IaaS 平台，让您能够迅速创建并管理基础结构，随处设置和访问任何主机。通过基于云的基础结构实现业务增长，降低许可、设置和备份的成本。</p>

<p>在此动手实验中，您将学习如何使用 SQL Server 并配置负载平衡，将一个简单的 ASP.NET MVC 4 Web 应用程序部署到 Windows Azure 中托管的 Web 服务器。</p>

<p><a name="Objectives"></a></p>

<h3 id="Objectives">目标</h3>

<p>在此动手实验中，您将学习如何执行以下操作：</p>

<ul>
<li>使用 Windows Azure 管理门户创建 Web 场</li>
<li>在 IIS 中配置负载平衡</li>
<li>部署使用 SQL Server 功能的简单 MVC4 应用程序</li>
<li>创建包含 SQL Server 全文搜索功能的虚拟机供 MVC 应用程序使用</li>
</ul>

<p><a name="Prerequisites"></a></p>

<h3 id="Prerequisites">先决条件</h3>

<p>下面是完成此动手实验需要满足的先决条件：</p>

<ul>
<li>启用了虚拟机预览的 Windows Azure 订阅 - <a href="http://aka.ms/WATK-FreeTrial">注册以免费试用</a></li>
</ul>

<hr />

<p><a name="Exercises"></a></p>

<h2 id="Exercises">练习</h2>

<p>此动手实验包括以下练习：</p>

<ol>
<li><a href="#Exercise1">创建 IIS 虚拟机</a></li>
<li><a href="#Exercise2">创建 SQL Server 虚拟机</a></li>
<li><a href="#Exercise3">部署简单的 MVC4 应用程序</a></li>
</ol>

<p>完成此实验的估计时间：<strong>45 分钟</strong>。</p>

<p><a name="Exercise1"></a></p>

<h3 id="Exercise_1_Creating_VMs_for_IIS">练习 1：创建 IIS 虚拟机</h3>

<p>在此练习中，您将学习如何在 Windows Azure 中创建虚拟机。然后，您将配置 Internet Information Server，添加在本实验后面要用到的角色。</p>

<p><a name="Ex1Task1"></a></p>

<h4 id="Task_1_-_Creating_IIS_VMs">任务 1 - 创建 IIS 虚拟机</h4>

<p>在此任务中，您将设置一个虚拟机并配置负载平衡以承载 MVC4 应用程序。</p>

<ol>
<li><p>打开 Internet Explorer 并浏览 <a href="https://manage.windowsazure.com/"><a href="https://manage.windowsazure.com/">https://manage.windowsazure.com/</a></a> 以进入 Windows Azure 门户。然后，使用您的凭据登录。</p></li>
<li><p>在位于底部的菜单中，选择<strong>“新建”|“计算”|“虚拟机”|“从库中”</strong>开始新建虚拟机。</p>

<p><img src="images/creating-a-new-virtual-machine.png?raw=true" alt="新建虚拟机" />
</p>

<p><em>新建虚拟机</em></p></li>
<li><p>在<strong>“选择虚拟机操作系统”</strong>页中，单击左侧菜单中的<strong>“平台映像”</strong>，然后从列表中选择<strong>“Windows Server 2008 R2 SP1，2012 年 8 月”</strong>操作系统映像。单击箭头继续。</p></li>
<li><p>在“虚拟机配置”页中，输入虚拟机名称（例如“iisvm1”）和管理员用户的密码。该密码须包含以下字符中的三种：小写字母、大写字母、数字和特殊字符。请务必记住您所做的选择。单击向右箭头继续。</p>

<p><img src="images/creating-a-vm-configuration.png?raw=true" alt="配置自定义虚拟机" />
</p>

<p><em>创建虚拟机 - 配置</em></p>
<blockquote>
<p><strong>注意：</strong>建议对管理用户使用安全密码，因为只要知道 Windows Azure 虚拟机的 DNS 就可以从 Internet 访问它们。</p>

<p>您也可以阅读 Microsoft 安全网站上的以下文档帮助选择安全密码：<a href="http://www.microsoft.com/security/online-privacy/passwords-create.aspx"><a href="http://www.microsoft.com/security/online-privacy/passwords-create.aspx">http://www.microsoft.com/security/online-privacy/passwords-create.aspx</a></a></p>
</blockquote></li>
<li><p>在<strong>“虚拟机模式”</strong>页中，选择<strong>“独立虚拟机”</strong>，输入 <strong>DNS 名称</strong>，选择一个<strong>存储帐户</strong>或保留默认值<em>“使用自动生成的存储帐户”</em>，然后选择一个<strong>区域/关联组/虚拟网络</strong>。单击<strong>向右箭头</strong>继续。</p>

<p><img src="images/creating-a-vm-vm-mode.png?raw=true" alt="配置自定义虚拟机，虚拟机模式" />
</p>

<p><em>创建虚拟机 - 虚拟机模式</em></p></li>
<li><p>在<strong>“虚拟机选项”</strong>页中，保留默认值并单击<strong>“完成”</strong>按钮创建新虚拟机。</p>

<p><img src="images/creating-a-vm--vm-options.png?raw=true" alt="创建虚拟机 - 虚拟机选项" title="创建虚拟机 - 虚拟机选项" />
</p>

<p><em>创建虚拟机 - 虚拟机选项</em></p></li>
<li><p>在<strong>“虚拟机”</strong>部分，您将看到所创建的虚拟机显示<em>“正在启动(正在配置)”</em>状态。等待状态变为<em>“正在运行”</em>，然后再继续后面的步骤，因为后面的步骤需要设置好的虚拟机。</p>

<p><img src="./images/creating-vm-for-iis-web-farm.png?raw=true" alt="创建 IIS Web 场虚拟机" title="创建 IIS Web 场虚拟机" />
</p>

<p><em>创建 IIS Web 场虚拟机</em></p>
<blockquote>
<p><strong>注意：</strong>虚拟机完成设置过程需要 8 到 10 分钟。</p>
</blockquote></li>
<li><p>您现在将再添加一个虚拟机以用于 IIS 负载平衡。在门户中，选择<strong>“新建”|“计算”|“虚拟机”|“从库中”</strong>。</p></li>
<li><p>在<strong>“选择虚拟机操作系统”</strong>页中，单击左侧菜单中的<strong>“平台映像”</strong>，然后从列表中选择<strong>“Windows Server 2008 R2 SP1，8 月”</strong>操作系统映像。单击<strong>箭头</strong>继续。</p></li>
<li><p>在<strong>“虚拟机配置”</strong>页中，输入<strong>虚拟机名称</strong>（例如 <em>iisvm2</em>）、管理员用户的<strong>密码</strong>和<strong>大小</strong>。单击<strong>向右箭头</strong>继续。</p></li>
<li><p>在<strong>“虚拟机模式”</strong>页中，选择<strong>“连接到现有的虚拟机”</strong>，然后从下拉列表选择您创建的第一个虚拟机。选择<strong>“存储帐户”</strong>或保留默认值<em>“使用自动生成的存储帐户”</em>，然后单击<strong>右箭头</strong>继续。此步骤将新虚拟机添加到在前面步骤中所创建的云服务。这样可以将两个虚拟机放在同一个网络上。</p>

<p><img src="images/creating-a-vm-vm-mode2.png?raw=true" alt="配置自定义虚拟机，虚拟机模式" />
</p>

<p><em>创建虚拟机 - 虚拟机模式</em></p></li>
<li><p>在<strong>“虚拟机选项”</strong>页中，保留默认值并单击按钮新建虚拟机。</p></li>
<li><p>等待第二个虚拟机创建完成。您可以从门户内的“虚拟机”部分检查虚拟机状态。</p>
<blockquote>
<p><strong>注意：</strong>虚拟机完成设置过程需要 8 到 10 分钟。</p>
</blockquote></li>
<li><p>在第二个虚拟机创建完成后，您将在先创建的虚拟机中的端口 80 中创建一个端点。为此，请单击第一个虚拟机的名称 (<em>iisvm1</em>) 以转到<strong>“面板”</strong>页，然后单击<strong>“端点”</strong>。在底部窗格上，单击<strong>“添加端点”</strong>。</p>

<p><img src="images/adding-a-new-endpoint-dashboard.png?raw=true" alt="在面板中选择“添加端点”" title="在面板中选择“添加端点”" />
</p>

<p><em>在面板中选择“添加端点”</em></p></li>
<li><p>请确保选中<strong>“添加端点”</strong>选项，然后单击<strong>右箭头</strong>按钮继续。</p>

<p><img src="images/adding-a-new-endpoint.png?raw=true" alt="添加新端点" title="添加新端点" />
</p>

<p><em>添加新端点</em></p></li>
<li><p>在<strong>“指定端点详细信息”</strong>页中，将<strong>“名称”</strong>设置为 <em>webport</em>，<strong>“协议”</strong>设置为 <em>TCP</em>，<strong>“公用端口”</strong>和<strong>“专用端口”</strong>设置为 <em>80</em>。单击按钮创建端点。等待端点创建完成后，才能继续进行下面的步骤。</p>

<p><img src="images/new-endpoint-details.png?raw=true" alt="新端点详细信息" title="新端点详细信息" />
</p>

<p><em>新端点详细信息</em></p>
<blockquote>
<p><strong>注意：</strong>创建新端点需要几分钟。</p>
</blockquote></li>
<li><p>现在，在第二个虚拟机中创建新端点，以便启用两个虚拟机之间的负载平衡。为此，请单击<strong>“虚拟机”</strong>，然后选择所创建的第二个虚拟机。之后，单击<strong>“端点”</strong>。</p></li>
<li><p>单击<strong>“添加端点”</strong>，选择<strong>“在现有端点上平衡流量负载”</strong>选项。从下拉列表选择为第一个虚拟机创建的端点，然后单击<strong>向右箭头</strong>继续。</p>

<p><img src="images/load-balance-traffic-an-an-existing-endpoint.png?raw=true" alt="在现有端点上平衡流量负载" title="在现有端点上平衡流量负载" />
</p>

<p><em>在现有端点上平衡流量负载</em></p></li>
<li><p>在<strong>“新建端点详细信息”</strong>页中，将<strong>“名称”</strong>设置为 <em>webport</em>，<strong>“专用端口”</strong>设置为 <em>80</em>。单击按钮创建端点。</p>
<blockquote>
<p><strong>注意：</strong>创建新端点需要几分钟。</p>
</blockquote></li>
<li><p>在<strong>“虚拟机”</strong>部分，单击第一个虚拟机的名称 (<em>iisvm1</em>)，然后单击<strong>“端点”</strong>。</p></li>
<li><p>选择您所创建的 <strong>webport</strong> 端点。请确保<strong>“负载平衡器”</strong>列值为<strong>“是”</strong>。</p>

<p><img src="images/creating-load-balancing-endpoint-1.png?raw=true" alt="验证：启用 IIS 负载平衡" />
</p>

<p><em>验证：启用 IIS 负载平衡</em></p></li>
<li><p>单击底部栏中的<strong>“编辑端点”</strong>按钮，输入端点详细信息并确认启用了负载平衡。在第二个虚拟机中重复此步骤。</p>

<p><img src="images/creating-load-balancing-endpoint-2.png?raw=true" alt="验证：启用 IIS 负载平衡，详细信息" />
</p>

<p><em>验证：启用 IIS 负载平衡，详细信息</em></p></li>
</ol>

<p><a name="Ex1Task2"></a></p>

<h4 id="Task_2_-_Configuring_IIS_VMs">任务 2 - 配置 IIS 虚拟机</h4>

<p>在此任务中，您将通过添加必需的角色来配置 IIS 虚拟机，用以部署 MVC 应用程序。</p>

<ol>
<li><p>在门户中，单击左侧菜单上<strong>“虚拟机”</strong>。</p></li>
<li><p>您将看到现有虚拟机的列表。选择在任务 1 中创建的第一个虚拟机，然后单击底部栏中的<strong>“连接”</strong>按钮。如果您使用了建议的名称，此虚拟机应命名为 <strong>iisvm1</strong>。</p></li>
<li><p>系统会要求您下载远程桌面设置文件。单击<strong>“打开”</strong>并使用您在创建虚拟机时定义的管理员凭据登录。</p></li>
<li><p>在 Azure 虚拟机中，从<strong>“开始”|“所有程序”|“管理工具”</strong>中打开<strong>“服务器管理器”</strong>。</p></li>
<li><p>在<strong>“服务器管理器”</strong>窗口中，选择<strong>“角色”</strong>节点。</p>

<p><img src="./images/Server-Manager.png?raw=true" alt="服务器管理器" title="服务器管理器" />
</p>

<p><em>服务器管理器</em></p></li>
<li><p>单击<strong>“添加角色”</strong>链接。</p>

<p><img src="./images/Adding-Server-Roles.png?raw=true" alt="添加服务器角色" title="添加服务器角色" />
</p>

<p><em>添加服务器角色</em></p></li>
<li><p><strong>“添加角色向导”</strong>会出现。</p></li>
<li><p>在<strong>“开始之前”</strong>页中，阅读内容并单击<strong>“下一步”</strong>。</p></li>
<li><p>在<strong>“选择服务器角色”</strong>页中，选中<strong>“应用程序服务器”</strong>和<strong>“Web 服务器(IIS)”</strong>。将显示一条警告，说明缺少必需的角色服务。单击<strong>“添加必需的功能”</strong>安装它们，然后单击<strong>“下一步”</strong>。</p>

<p><img src="images/add-roles-wizard2.png?raw=true" alt="添加角色向导 (2)" />
</p>

<p><em>添加角色向导</em></p></li>
<li><p><strong>“应用程序服务器”</strong>页提供了有关应用程序服务器的功能简介。阅读内容后，单击<strong>“下一步”</strong>。</p></li>
<li><p>在<strong>“应用程序服务器”</strong>的<strong>“选择角色服务”</strong>页中，选择<strong>“Web 服务器(IIS)</strong><strong>支持”</strong>并确保选中 <strong>.NET Framework 3.5.1</strong>。系统会出现有关缺少必需的角色服务的对话框警告。单击<strong>“添加必需的角色服务”</strong>安装这些角色服务，然后单击<strong>“下一步”</strong></p>

<p><img src="images/add-roles-wizard3.png?raw=true" alt="添加角色向导 (3)" />
</p>

<p><em>添加角色向导</em></p></li>
<li><p><strong>“Web 服务器(IIS)”</strong>页提供了有关 Web 服务器 (IIS) 的功能简介。阅读内容后，单击<strong>“下一步”</strong>。</p></li>
<li><p><strong>“Web Server (IIS)”</strong>页的<strong>“选择角色服务”</strong>页会显示选定要安装的角色服务。单击<strong>“下一步”</strong>。</p>

<p><img src="images/add-roles-wizard4.png?raw=true" alt="添加角色向导 (4)" />
</p>

<p><em>添加角色向导</em></p></li>
<li><p>在<strong>“确认安装选择”</strong>页中，确保显示要安装的服务是您所选择的服务（.NET Framework 3.5.1 支持和 IIS），然后单击<strong>“安装”</strong>。</p>

<p><img src="./images/Add-Roles-Wizard.png?raw=true" alt="添加角色向导" title="添加角色向导" />
</p>

<p><em>添加角色向导</em></p>
<blockquote>
<p><strong>注意：</strong>完成安装需要几分钟。</p>
</blockquote></li>
<li><p>关闭<strong>远程桌面连接</strong>。</p>

<p>在第二个虚拟机上从步骤 4 开始重复此任务以安装 IIS。如果您使用了建议的名称，第二个虚拟机应命名为 <strong>iisvm2</strong>。</p></li>
</ol>

<p><a name="Exercise2"></a></p>

<h3 id="Exercise_2_Creating_a_SQL_Server_VM">练习 2：创建 SQL Server 虚拟机</h3>

<p>在此练习中，您将创建一个新虚拟机并学习如何安装 SQL Server。您将在现有虚拟机中添加磁盘映像，以便从 SQL Server 生成的日志拆分数据。</p>

<p><a name="Ex2Task1"></a></p>

<h4 id="Task_1_-_Creating_a_SQL_Server_VM">任务 1 - 创建 SQL Server 虚拟机</h4>

<p>在此任务中，您将使用 Windows Azure 门户，在部署了 IIS 虚拟机的同一个云应用中创建一个新虚拟机。</p>

<ol>
<li><p>在位于底部的菜单中，选择<strong>“新建”|“计算”|“虚拟机”|“从库中”</strong>开始新建虚拟机。</p></li>
<li><p>在<strong>“选择虚拟机操作系统”</strong>页中，单击左侧菜单中的<strong>“平台映像”</strong>，然后从列表中选择<strong>“Microsoft SQL Server 2012”</strong>映像。单击箭头继续。</p></li>
<li><p>在<strong>“虚拟机配置”</strong>页中，输入<strong>虚拟机名称</strong>（例如 <em>sqlvm1</em>）、管理员用户的<strong>密码</strong>和<strong>大小</strong>。单击<strong>向右箭头</strong>继续。</p></li>
<li><p>在<strong>“虚拟机模式”</strong>页中，选择<strong>“连接到现有的虚拟机”</strong>，然后从下拉列表选择您创建的第一个 IIS 虚拟机 (<em>iisvm1</em>)。单击<strong>向右箭头</strong>继续。</p></li>
<li><p>在<strong>“虚拟机选项”</strong>页中，保留默认值并单击按钮新建虚拟机。</p></li>
<li><p>在<strong>“虚拟机”</strong>部分，您将看到所创建的虚拟机显示<em>“正在配置”</em>状态。等待状态变为<em>“正在运行”</em>，然后再继续后面的步骤。</p>
<blockquote>
<p><strong>注意：</strong>虚拟机完成设置过程需要 8 到 10 分钟。</p>
</blockquote></li>
</ol>

<p><a name="Ex2Task2"></a> </p>

<h4 id="Task_2_-_Attaching_Empty_Disk_Images">任务 2 - 附加空磁盘映像</h4>

<p>在此任务中，您将使用 Windows Azure 管理门户创建两个空数据磁盘，然后将它们附加到现有的虚拟机。您将使用这些数据磁盘来拆分 SQL Server 数据和日志。</p>

<ol>
<li><p>现在，您将创建并附加空数据磁盘来存储 SQL Server 日志和数据文件，还要添加一个端点。为此，请在<strong>“虚拟机”</strong>部分，选择在前面的任务中所创建的 SQL Server 虚拟机。</p></li>
<li><p>在虚拟机的<strong>“面板”</strong>中，单击页面底部菜单中的<strong>“附加”</strong>并选择<strong>“附加空磁盘”</strong>。</p>

<p><img src="images/attach-empty-disk.png?raw=true" alt="附加空磁盘" title="附加空磁盘" />
</p>

<p><em>附加空磁盘</em></p></li>
<li><p>在<strong>“附加空磁盘”</strong>页中，将<strong>“大小”</strong>设置为 <em>50</em> GB，然后创建磁盘。</p></li>
<li><p>等待附加磁盘过程完成。重复步骤 1 至 3 创建第二个磁盘。</p></li>
<li><p>打开虚拟机的<strong>“面板”</strong>。您将看到三个磁盘：<strong>操作系统</strong>磁盘和用于<strong>数据</strong>和<strong>日志</strong>的另外两个磁盘。</p>
<blockquote>
<p><strong>注意：</strong>数据磁盘可能需要几分钟才能在 Azure 门户内的虚拟机面板中出现。</p>
</blockquote>
<p><img src="./images/Attached-Data-Disks.png?raw=true" alt="附加的数据磁盘" title="附加的数据磁盘" />
</p>

<p><em>附加的数据磁盘</em></p></li>
<li><p>最后，您需要格式化这些磁盘，以便从虚拟机访问它们。为此，请单击<strong>“连接”</strong>以使用<strong>远程桌面连接</strong>连接到虚拟机。</p></li>
<li><p>系统会要求您下载远程桌面设置文件。单击<strong>“打开”</strong>并使用您在创建虚拟机时定义的管理员凭据登录。</p></li>
<li><p>在虚拟机中，从<strong>“开始”|“所有程序”|“管理工具”</strong>中打开<strong>“服务器管理器”</strong>。</p></li>
<li><p>展开<strong>“存储”</strong>节点，然后选择<strong>“磁盘管理”</strong>选项。</p>

<p><img src="images/disk-management2.png?raw=true" alt="磁盘管理 (2)" />
</p>

<p><em>磁盘管理</em></p></li>
<li><p>将出现<strong>“初始化磁盘”</strong>对话框。保留默认值，然后单击<strong>“确定”</strong>。</p></li>
<li><p>右键单击第一个磁盘的未分配空间并选择<strong>“新建简单卷”</strong>。</p>

<p><img src="images/disk-management.png?raw=true" alt="磁盘管理" />
</p>

<p><em>磁盘管理</em></p></li>
<li><p>根据<strong>“新建简单卷向导”</strong>执行操作。系统要求输入<strong>卷标</strong>时，使用 <em>SQLData</em> 作为卷标。</p></li>
<li><p>等待第一个磁盘创建完成。重复步骤 11 至 12，但这次使用第二个磁盘。将<strong>“卷标”</strong>设置为 <em>SQLLogs</em>。</p></li>
<li><p>现在可用磁盘的<strong>“磁盘管理”</strong>列表应显示 <strong>SQLData</strong> 和 <strong>SQLLogs</strong> 磁盘，如下图所示：</p>

<p><img src="./images/Disks-Management.png?raw=true" alt="磁盘管理" title="磁盘管理" />
</p>

<p><em>磁盘管理</em></p>
<blockquote>
<p><strong>注意：</strong>请不要关闭<strong>远程桌面连接</strong>。您将在以下的任务中用到它。</p>
</blockquote></li>
</ol>

<p><a name="Ex2Task3"></a> </p>

<h4 id="Task_3_-_Configuring_SQL_Server_in_the_VM">任务 3 - 在虚拟机中配置 SQL Server</h4>

<p>在此任务中，您将配置 SQL Server 2012。您将创建将由 MVC4 应用程序使用的数据库并将全文搜索功能添加到该数据库。此外，您将为 MVC4 网站创建一个 SQL Server 用户。</p>

<ol>
<li><p>打开 Windows 资源管理器，然后创建以下文件夹：<strong>F:\Data、G:\Logs</strong> 和 <strong>G:\Backups</strong>。</p></li>
<li><p>从<strong>“开始”|“所有程序”|“Microsoft SQL Server 2012”|“SQL Server Management Studio”</strong>打开 SQL Server Management Studio。</p></li>
<li><p>使用您的 Windows 帐户连接到 SQL Server 2012 默认实例。</p></li>
<li><p>现在，您将更新数据库的默认位置以便拆分“日志”和“数据”。为此，请右键单击您的 SQL Server 实例，再选择<strong>“属性”</strong>。</p></li>
<li><p>从左侧窗格中选择<strong>“数据库设置”</strong>。</p></li>
<li><p>找到<strong>“数据库默认位置”</strong>部分，更新默认值使之指向在前面的任务中附加的磁盘，然后单击“确定”。</p>

<p><img src="./images/Setting-Database-Default-Locations.png?raw=true" alt="设置数据库默认位置" title="设置数据库默认位置" />
</p>

<p><em>设置数据库默认位置</em></p></li>
<li><p>现在，必须重新启动服务使更改生效。若要重新启动服务，请从上下文菜单中右键单击 SQL Server 实例并选择<strong>“重新启动”</strong>。</p></li>
<li><p>重新启动 SQL Server。在<strong>对象资源管理器</strong>中，右键单击服务器节点，然后选择<strong>“重新启动”</strong>。</p></li>
<li><p>为启用从 Internet Explorer 下载功能，需要更新<strong>“Internet Explorer 增强的安全配置”</strong>。在 Azure 虚拟机中，从<strong>“开始”|“所有程序”|“管理工具”</strong>中打开<strong>“服务器管理器”</strong>。</p></li>
<li><p>在<strong>“服务器管理器”</strong>中，单击<strong>“安全信息”</strong>部分的<strong>“配置 IE ESC”</strong>。</p>

<p><img src="./images/configuring-internet-explorer-enhanced-security-configuration.png?raw=true" alt="配置 IE ESC" title="配置 IE ESC" />
</p>

<p><em>配置 IE ESC</em></p></li>
<li><p>在<strong>“Internet Explorer 增强的安全配置”</strong>中，<strong>关闭</strong><strong>管理员</strong>的增强安全配置，然后单击<strong>“确定”</strong>。</p>

<p><img src="images/internet-explorer-enhanced-security2.png?raw=true" alt="Internet Explorer 增强的安全配置 (2)" />
</p>

<p><em>Internet Explorer 增强的安全配置</em></p>
<blockquote>
<p><strong>注意：</strong>修改<strong>“Internet Explorer 增强的安全配置”</strong>不宜作为常规做法，在此仅为本次特定实验临时使用。正确的做法应是从本地下载文件，然后将文件复制到共享文件夹或直接复制到虚拟机。</p>
</blockquote></li>
<li><p>此实验使用 <strong>AdventureWorks</strong> 数据库。打开 <strong>Internet Explorer</strong> 浏览器，然后转到 <a href="http://msftdbprodsamples.codeplex.com/">http://msftdbprodsamples.codeplex.com/</a> 下载 <strong>SQL Server 2012</strong> 示例数据库。进入页面后，单击 SQL Server 2012 DW，然后下载 Adventure Works 2012 数据文件。将文件下载到 F:\Data。</p>
<blockquote>
<p><strong>注意：</strong><strong>AdventureWorks</strong> 数据库也可以作为 .zip 文件下载。如果选择此格式，请右键单击该文件打开其属性窗口，然后单击<strong>“取消阻止”</strong>。然后，将该数据库解压到 F:\Data。</p>
</blockquote></li>
<li><p>将 <strong>AdventureWorks</strong> 示例数据库添加到您的 SQL Server 中。为此，请在 <strong>SQL Server Management Studio</strong> 中找到您的 SQL Server 实例节点并将其展开。右键单击<strong>“数据库”</strong>文件夹并选择<strong>“附加”</strong>。</p>

<p><img src="images/attaching-adventureworks-database-menu.png?raw=true" alt="附加数据库" />
</p>

<p><em>附加数据库</em></p></li>
<li><p>在<strong>“附加数据库”</strong>对话框中，按<strong>“添加”</strong>。浏览到数据磁盘并选择 Adventure Works 数据文件。</p></li>
<li><p>选择 <strong>AdventureWorks2012</strong> 日志条目并单击<strong>“删除”</strong>。</p>

<p><img src="images/removing-adventureworks-log-entry.png?raw=true" alt="删除 AdventureWorks2012 日志条目。" />
</p>

<p><em>删除 AdventureWorks2012 日志条目。</em></p></li>
<li><p>按<strong>“确定”</strong>添加数据库。</p></li>
<li><p>在<strong>“数据库”</strong>文件夹中，找到新的 <strong>AdventureWorks2012</strong> 数据库并查看该数据库中的表。</p>

<p><img src="./images/adventureworks-sample-database.png?raw=true" alt="AdventureWorks 示例数据库" title="Northwind 示例数据库" />
</p>

<p><em>AdventureWorks 示例数据库</em></p></li>
<li><p>展开 <strong>AdventureWorks</strong> 数据库中的<strong>“存储”</strong>节点，右键单击<strong>“全文目录”</strong>文件夹并选择<strong>“新建全文目录”</strong>。</p>
<blockquote>
<p><strong>注意：</strong>您正在为数据库创建全文目录以供 MVC 应用程序在后面使用。</p>
</blockquote>
<p><img src="images/create-new-full-text-catalog2.png?raw=true" alt="创建新全文目录 (2)" />
</p>

<p><em>创建新全文目录</em></p></li>
<li><p>在“新建全文目录”对话框中，将<strong>“名称”</strong>值设置为 <em>AdventureWorksCatalog</em>，然后按<strong>“确定”</strong>。</p>

<p><img src="images/create-new-full-text-catalog3.png?raw=true" alt="创建新全文目录 (3)" />
</p>

<p><em>创建新全文目录</em></p></li>
<li><p>检查您创建的全文目录是否出现在<strong>“全文目录”</strong>文件夹中。</p>

<p><img src="images/create-new-full-text-catalog5.png?raw=true" alt="创建新全文目录 (4)" />
</p>

<p><em>创建新全文目录</em></p></li>
<li><p>右键单击 <strong>AdventureWorksCatalog</strong>，然后选择<strong>“属性”</strong>。在<strong>“全文目录属性”</strong>对话框中，切换到<strong>“表/视图”</strong>页。</p></li>
<li><p>将 <strong>Production.Product</strong> 表添加到<strong>“分配给该目录的表/视图对象”</strong>列表中。然后，选中<em>“名称”</em>列并单击<strong>“确定”</strong>。</p>

<p><img src="images/create-new-full-text-catalog4.png?raw=true" alt="创建新全文目录 (5)" />
</p>

<p><em>创建新全文目录</em></p></li>
<li><p>添加一个新用户，该用户将用于下面练习中部署的 MVC4 应用程序。为此，请展开 SQL Server 实例中的<strong>“安全性”</strong>文件夹。右键单击<strong>“登录”</strong>文件夹，然后选择<strong>“新建登录名”</strong>。</p>

<p><img src="images/creating-a-new-login2.png?raw=true" alt="创建新登录名 (2)" />
</p>

<p><em>创建新登录名</em></p></li>
<li><p>在<strong>“常规”</strong>部分，将<strong>“登录名”</strong>设置为 <em>CloudShop</em>。选择<strong>“SQL Server 身份验证”</strong>选项并将<strong>“密码”</strong>设置为 <em>Azure$123</em>。</p>
<blockquote>
<p><strong>注意：</strong>如果您输入的用户名或密码与本步中的建议不同，请不要忘记在下一练习中更新 MVC4 应用程序的 web.config 文件，以使值匹配。</p>
</blockquote></li>
<li><p>取消选中<strong>“强制实施密码策略”</strong>复选框以避免首次登录时必须更改密码，并将<strong>“默认数据库”</strong>设置为 <em>AdventureWorks</em>。</p>

<p><img src="./images/Creating-a-New-Login.png?raw=true" alt="创建新登录名" title="创建新登录名" />
</p>

<p><em>创建新登录名</em></p></li>
<li><p>在左窗格中，单击<strong>“用户映射”</strong>。选中 <em>AdventureWorks</em> 数据库行中的映射复选框，并单击<strong>“确定”</strong>。</p>

<p><img src="./images/mapping-new-user-database-2.png?raw=true" alt="将新用户映射到 AdventureWorks 数据库" title="将新用户映射到 AdventureWorks 数据库" />
</p>

<p><em>将新用户映射到 AdventureWorks 数据库</em></p></li>
<li><p>展开<strong>“数据库”</strong>文件夹中的 <strong>AdventureWorks</strong> 数据库。在<strong>“安全性/用户”</strong>文件夹中，双击 <strong>CloudShop</strong> 用户。</p></li>
<li><p>选择<strong>“成员身份”</strong>页，再选择 <strong>CloudShop</strong> 用户的 <em>db_owner</em> 角色复选框，然后单击<strong>“确定”</strong>。</p>

<p><img src="./images/Adding-Database-role-membership-to-CloudShop-user.png?raw=true" alt="向 CloudShop 用户添加数据库角色成员身份" title="向 CloudShop 用户添加数据库角色成员身份" />
</p>

<p><em>向 CloudShop 用户添加数据库角色成员身份</em></p>
<blockquote>
<p><strong>注意：</strong>在下一练习中部署的应用程序将使用“通用提供程序”管理会话。应用程序首次运行时，提供程序将在数据库中创建一个 Sessions 表。因此，您将把 db_owner 角色分配给 CloudShop 用户。首次运行该应用程序后，就可以删除此角色，因为不需要这些权限。</p>
</blockquote></li>
<li><p>现在，对 SQL Server 实例启用<strong>“混合模式身份验证”</strong>。为此，请在 <strong>SQL Server Management Studio</strong> 中右键单击服务器实例，然后单击<strong>“属性”</strong>。</p></li>
<li><p>在左侧窗格中单击<strong>“安全性”</strong>，然后在<strong>“服务器身份验证”</strong>部分下选择<strong>“SQL Server 和 Windows 身份验证模式”</strong>。单击<strong>“确定”</strong>保存更改。</p></li>
<li><p>重新启动 SQL Server 实例。为此，请右键单击 SQL Server 实例，然后单击<strong>“重新启动”</strong>。</p></li>
<li><p>关闭 <strong>SQL Server Management Studio</strong>。</p></li>
<li><p>为允许 MVC4 应用程序访问 SQL Server 数据库，您需要在<strong>“Windows 防火墙”</strong>中为 SQL Server 请求添加一条<strong>“入站规则”</strong>。为此，请从<strong>“开始”|“所有程序”|“管理工具”</strong>中打开<strong>“高级安全 Windows 防火墙”</strong>。</p></li>
<li><p>选择<strong>“入站规则”</strong>节点，右键单击该节点并选择<strong>“新建规则”</strong>以打开<strong>“新建入站规则向导”</strong>。</p>

<p><img src="./images/Creating-an-Inbound-Rule.png?raw=true" alt="创建入站规则" title="创建入站规则" />
</p>

<p><em>创建入站规则</em></p></li>
<li><p>在<strong>“规则类型”</strong>页中，选择<strong>“端口”</strong>，然后单击<strong>“下一步”</strong>。</p>

<p><img src="images/new-inbound-rule-wizard2.png?raw=true" alt="新建入站规则向导" />
</p>

<p><em>新建入站规则向导</em></p></li>
<li><p>在<strong>“协议和端口”</strong>页中，保持 TCP 的选中状态，选择<strong>“特定本地端口”</strong>，将其值设置为 <em>1433</em>。单击<strong>“下一步”</strong>继续。</p>

<p><img src="images/new-inbound-rule-wizard.png?raw=true" alt="新建入站规则向导" />
</p>

<p><em>新建入站规则向导</em></p></li>
<li><p>在<strong>“操作”</strong>页中，确保选中<strong>“允许连接”</strong>并单击<strong>“下一步”</strong>。</p>

<p><img src="images/new-inbound-rule-wizard3.png?raw=true" alt="新建入站规则向导 (3)" />
</p>

<p><em>新建入站规则向导</em></p></li>
<li><p>在<strong>“配置文件”</strong>页中，保留默认值并单击<strong>“下一步”</strong>。</p></li>
<li><p>在<strong>“名称”</strong>页中，将入站规则的<strong>“名称”</strong>设置为 <em>SQLServerRule</em>，然后单击<strong>“完成”</strong>。</p>

<p><img src="images/new-inbound-rule-wizard4.png?raw=true" alt="新建入站规则向导 (4)" />
</p>

<p><em>新建入站规则向导</em></p></li>
<li><p>关闭<strong>“高级安全 Windows 防火墙”</strong>窗口。</p>
<blockquote>
<p><strong>注意：</strong>确保为服务器实例启用了 Named Pipes 和 TCP/IP 协议。您可以进入“SQL Server 配置管理器”验证这些设置，并在“SQL Server 配置管理器”节点中检查这些协议的状态是否设置为启用。</p>

<p>请记住在启用协议后重新启动 SQL Server 实例。</p>
</blockquote></li>
<li><p>关闭<strong>远程桌面连接</strong>。</p></li>
</ol>

<p><a name="Exercise3"></a> </p>

<h3 id="Exercise_3_Deploying_a_Simple_MVC4_Application">练习 3：部署简单的 MVC4 应用程序</h3>

<p>在此练习中，您将学习如何在您之前配置的 Azure 虚拟机的 IIS 中部署简单的 ASP.NET MVC4 应用程序。</p>
<blockquote>
<p><strong>注意：</strong>为了提高此解决方案的可用性，您需要在可用性集里面配置这些 SQL Server，并设置实例之间的 SQL Server 镜像。</p>
</blockquote>
<p><a name="Ex3Task1"></a></p>

<h4 id="Task_1_-_Deploying_a_Simple_MVC4_Application">任务 1 - 部署简单的 MVC4 应用程序</h4>

<p>在此任务中，您将把 MVC4 应用程序部署到 IIS 虚拟机。</p>

<ol>
<li><p>在 Azure 门户中，单击左侧菜单上的<strong>“虚拟机”</strong>。</p></li>
<li><p>您将看到现有虚拟机的列表。选择在练习 1 中创建的第一个虚拟机并单击<strong>“连接”</strong>。如果您使用了建议的名称，此虚拟机应命名为 <strong>iisvm1</strong>。</p></li>
<li><p>系统会提示您下载远程桌面客户端。单击<strong>“打开”</strong>并使用您在创建虚拟机时定义的管理员凭据登录。</p></li>
<li><p>您将需要安装 <strong>.NET Framework 4.0</strong>，然后才能部署 MVC4 应用程序。为此，您将启用从 IE 下载，更新<strong>“Internet Explorer 增强的安全配置”</strong>。</p>

<ol>
<li>在 Azure 虚拟机中，从<strong>“开始”|“所有程序”|“管理工具”</strong>中打开“服务器管理器”。</li>
<li><p>在<strong>“服务器管理器”</strong>中，单击<strong>“安全信息”</strong><strong></strong>部分的<strong>“配置 IE ESC”</strong>。</p>

<p><img src="images/internet-explorer-enhanced-security3.png?raw=true" alt="Internet Explorer 增强的安全配置 (3)" />
</p>

<p><em>Internet Explorer 增强的安全配置</em></p></li>
<li><p>在<strong>“Internet Explorer 增强的安全配置”</strong>对话框中，<strong>关闭</strong><strong>管理员</strong>的增强安全配置，然后单击<strong>“确定”</strong>。</p>

<p><img src="./images/Internet-Explorer-Enhanced-Security.png?raw=true" alt="Internet Explorer 增强的安全配置" title="Internet Explorer 增强的安全配置" />
</p>

<p><em>Internet Explorer 增强的安全配置</em></p>
<blockquote>
<p><strong>注意：</strong>修改“Internet Explorer 增强的安全配置”不宜作为常规做法，在此仅为本次特定实验临时使用。正确的做法应是从本地下载文件，然后将文件复制到共享文件夹或直接复制到虚拟机。</p>
</blockquote></li>
</ol></li>
<li><p>现在您拥有下载文件的权限，打开 <strong>Internet Explorer</strong> 浏览器会话并导航到 <a href="http://go.microsoft.com/fwlink/?linkid=186916"><a href="http://go.microsoft.com/fwlink/?linkid=186916">http://go.microsoft.com/fwlink/?linkid=186916</a></a>。下载并安装 <strong>.NET Framework 4.0</strong>。</p></li>
<li><p><strong>.Net Framework 4.0</strong> 安装完成后，打开位于 <strong>C:\inetpub</strong> 中的 <strong>wwwroot</strong> 文件夹，然后复制位于本实验的 <strong>CloudShop\Source\Assets</strong> 文件夹中的文件 <strong>CloudShop.zip</strong>。为此，请复制 <strong>CloudShop.zip</strong> (<strong>Ctrl + C</strong>) 并将其粘贴 (<strong>Ctrl + V</strong>) 到虚拟机的 <strong>wwwroot</strong> 文件夹。将所有文件解压到 <strong>C:\inetpub\wwwroot\CloudShop</strong> 文件夹。</p>

<p><img src="./images/wwwroot-folder.png?raw=true" alt="wwwroot 文件夹" title="wwwroot 文件夹" />
</p>

<p><em>wwwroot 文件夹</em></p></li>
<li><p>使用<strong>“记事本”</strong>打开位于 <strong>C:\inetpub\wwwroot\CloudShop</strong> 中的 <strong>Web.config</strong> 文件。在文件的末尾，将连接字符串占位符替换为您的 SQL Server 的名称（在默认情况下，为虚拟机的名称）。</p>

<!--mark: 1-4 -->

<span class="codelanguage">XML</span><pre><code class="XML"><strong class="markLine"><span style="color:#0000FF">&lt;</span><span style="color:#800000">connectionStrings</span><span style="color:#0000FF">&gt;</span></strong>
<strong class="markLine">    <span style="color:#0000FF">&lt;</span><span style="color:#800000">add</span> <span style="color:#FF0000">name</span>=<span style="color:#0000FF">&quot;AdventureWorksEntities&quot;</span> <span style="color:#FF0000">connectionString</span>=<span style="color:#0000FF">&quot;metadata=res://*/Models.AdventureWorks.csdl|res://*/Models.AdventureWorks.ssdl|res://*/Models.AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=[ENTER YOUR SQL SERVER NAME];initial catalog=AdventureWorks2012;Uid=CloudShop;Password=Azure$123;multipleactiveresultsets=True;App=EntityFramework&amp;quot;&quot;</span> <span style="color:#FF0000">providerName</span>=<span style="color:#0000FF">&quot;System.Data.EntityClient&quot;</span> <span style="color:#0000FF">/&gt;</span></strong>
<strong class="markLine">    <span style="color:#0000FF">&lt;</span><span style="color:#800000">add</span> <span style="color:#FF0000">name</span>=<span style="color:#0000FF">&quot;DefaultConnection&quot;</span> <span style="color:#FF0000">connectionString</span>=<span style="color:#0000FF">&quot;Data Source=[ENTER YOUR SQL SERVER NAME];initial catalog=AdventureWorks2012;Uid=CloudShop;Password=Azure$123;MultipleActiveResultSets=True&quot;</span> <span style="color:#FF0000">providerName</span>=<span style="color:#0000FF">&quot;System.Data.SqlClient&quot;</span> <span style="color:#0000FF">/&gt;</span></strong>
<strong class="markLine"><span style="color:#0000FF">&lt;/</span><span style="color:#800000">connectionStrings</span><span style="color:#0000FF">&gt;</span></strong>
</code></pre></li>
<li><p>从<strong>“开始”|“所有程序”|“管理工具”</strong>打开<strong>“Internet 信息服务(IIS)管理器”</strong>。</p></li>
<li><p>在<strong>“连接”</strong>窗格中，展开您的 IIS 服务器节点内的<strong>“默认网站”</strong>。您将看到在 <strong>wwwroot</strong> 中复制的 <strong>CloudShop</strong> 文件夹。</p>

<p><img src="./images/IIS-Manager.png?raw=true" alt="IIS 管理器" title="IIS 管理器" />
</p>

<p><em>IIS 管理器</em></p></li>
<li><p>右键单击 <strong>CloudShop</strong> 文件夹，然后选择<strong>“转换为应用程序”</strong>。</p>

<p><img src="images/iis-manager-convert-to-application.png?raw=true" alt="IIS 管理器转换为应用程序" />
</p>

<p><em>IIS 管理器 - 转换为应用程序</em></p></li>
<li><p>在<strong>“添加应用程序”</strong>对话框中，单击<strong>“确定”</strong>。</p>

<p><img src="./images/Add-Application-dialog.png?raw=true" alt="添加应用程序对话框" title="添加应用程序对话框" />
</p>

<p><em>添加应用程序对话框</em></p></li>
<li><p>最后，选择<strong>“应用程序池”</strong>节点，并双击 <strong>DefaultAppPool</strong> 应用程序池。</p>

<p><img src="./images/Updating-Default-Application-Pool.png?raw=true" alt="更新默认应用程序池" title="更新默认应用程序池" />
</p>

<p><em>更新默认应用程序池</em></p></li>
<li><p>在<strong>“编辑应用程序池”</strong>对话框中，将 <strong>.Net Framework</strong> 的版本更改为 <strong>v4.0</strong> 并单击<strong>“确定”</strong>。</p>

<p><img src="./images/Editing-Application-Pool.png?raw=true" alt="编辑应用程序池" title="编辑应用程序池" />
</p>

<p><em>编辑应用程序池</em></p></li>
<li><p>现在 <strong>DefaultAppPool</strong> 的 .Net Framework 应为 <strong>v4.0</strong>，而不是 v2.0。</p>

<p><img src="./images/Updating-Default-Application-Pool-Updated.png?raw=true" alt="更新默认应用程序池" title="更新默认应用程序池" />
</p>

<p><em>更新默认应用程序池</em></p></li>
<li><p>关闭<strong>“Internet 信息服务(IIS)管理器”</strong>窗口。</p></li>
<li><p>关闭<strong>远程桌面连接</strong>。</p></li>
<li><p>在您在<strong>练习 1 - 任务 1</strong> 中创建的第二个虚拟机中重复此任务。如果您使用了建议的名称，此虚拟机应命名为 <strong>iisvm2</strong>。</p></li>
</ol>

<p><a name="Verification"></a> </p>

<h4 id="Verification">验证</h4>

<p>在此任务中，您将测试在前面的任务中部署的 Cloud Shop MVC4 应用程序。</p>

<ol>
<li><p>在您的本地计算机中，打开 <strong>Internet Explorer</strong>。</p></li>
<li><p>转到 http://[<strong>服务名称</strong>].cloudapp.net/CloudShop。“服务名称”是您在创建 IIS 虚拟机时使用的名称（您也可以在 Azure 门户中的虚拟机面板内检查该名称）。</p>

<p><img src="./images/MVC4-Application-running-in-the-Web-Farm.png?raw=true" alt="在 Web 场中运行的 MVC4 应用程序" title="在 Web 场中运行的 MVC4 应用程序" />
</p>

<p><em>在 Web 场中运行的 MVC4 应用程序</em></p></li>
<li><p>在<strong>搜索</strong>框中，输入 <em>Classic</em>，然后单击 <strong>Search</strong>（搜索）。页面会显示产品名符合搜索条件的所有产品。</p>

<p><img src="images/searching-products2.png?raw=true" alt="搜索产品 (2)" />
</p>

<p><em>搜索产品</em></p></li>
</ol>

<hr /> </span>
		</div>
	<br/>
	<p><a href="#top">返回页首</a></p>


				</div>
			</section>
			<footer>
				<div class="footer-sitemap" style="border-top:0"></div>
				<div class="footer-bottom">
					<ul>
						<li class="footer-copyright"><a href="http://www.microsoft.com"><img alt="microsoft" src="images/microsoft.png" /></a></li>					
												<li><a href="https://github.com/WindowsAzure-TrainingKit/HOL-IntroToWindowsAzureVirtualMachines/issues" target="_new">记录问题</a></li>
												<li><a href="mailto:azcfeed@microsoft.com?subject=Windows Azure Training Kit">联系我们</a></li>
						<li><a href="EULA.htm">使用条款</a></li>
						<li><a href=".\">浏览内容</a></li>
						<li>&copy; 2012 Microsoft</li>
					</ul>
				</div>
			</footer>
			</div>
        </div>
    </div>
</body>
</html>

