<!DOCTYPE html>

<html class="no-js" lang="en" class="js flexbox canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head id="ContentPlaceHolderDefault_Head1">
    <meta http-equiv="X-UA-Compatible" content="IE=9,chrome=1" />
    <meta charset=UTF-8" />
    <title>Windows Azure 培训包 - 使用 Windows Azure 网站和 Team Foundation Service 发布 ASP.NET 应用程序</title>
    <link rel="Stylesheet" type="text/css" media="all" href="styles/master.css" />
</head>
<body id="top" class="page-">
    <div id="page">
        <div id="wrapper" class="landingPage getStartedPage">            
            <div class="header">								
				<img alt="Windows Azure" src="images/azure-logo.png" /> <span class="mainHomepageSubTitle">培训包 - 2012 年 12 月更新</span>								
			</div>			
			<div class="nav-menu-header">
				<nav>
					<ul>
						<li class="MenuLink-Selected">
							<a href="#">内容</a>
						</li>
												<li class="MenuLink">
							<a href="Source">设置</a>
						</li>
											</ul>
				
										
						<span id="github-btn" class="github-btn"> <a id="gh-btn" title="在 GitHub 中复制此存储库的分支" href="https://github.com/WindowsAzure-TrainingKit/HOL-ASPNETAzureWebSitesTFS" target="_blank" class="gh-btn"> <span class="gh-ico"></span> <span id="gh-text" class="gh-text">分支</span> </a> </span> <span id="github-btn" class="github-btn github-watchers"> <a id="gh-btn" title="在 GitHub 中关注此存储库" href="https://github.com/WindowsAzure-TrainingKit/HOL-ASPNETAzureWebSitesTFS" target="_blank" class="gh-btn"> <span class="gh-ico"></span> <span id="gh-text" class="gh-text">关注</span> </a> </span>
						
									
				</nav>
			</div>	        
		</span>
			<div id="content" class="textpage">
            <section id="content-container">
				<div id="content" class="textpage">
			    <a name="top"></a>
				
				

		<div class="content">
			<?xml version="1.0" encoding="iso-8859-1"?><span><p><a name="Title"></a></p>

<h1 id="Publishing_ASPNET_Applications_with_Windows_Azure_Web_Sites_and_Team_Foundation_Service">使用 Windows Azure 网站和 Team Foundation Service 发布 ASP.NET 应用程序</h1>

<hr />

<p><a name="Overview"></a></p>

<h2 id="Overview">概述</h2>

<p>在此动手实验中，您将学习如何将 Windows Azure 网站链接到 Team Foundation Service (TFS) 存储库，以便签入更改并在您的网站中自动反映这些更新。</p>

<p>在这些练习中，您将从 <strong>Windows Azure 管理门户</strong>创建一个新<strong>网站</strong>，并启用 TFS 发布。最后，您将在 <strong>Microsoft Visual Studio 2012</strong> 中创建一个简单的 MVC4 应用程序，然后签入到 TFS 服务器。更新 TFS 存储库后，您将可以看到 Windows Azure 网站中如何自动反映所做的更改。</p>

<p><a name="Objectives"></a></p>

<h3 id="Objectives">目标</h3>

<p>在此动手实验中，您将学习如何执行以下操作：</p>

<ul>
<li>从 Windows Azure 管理门户创建网站</li>
<li>将 Windows Azure 网站链接到新的或现有的 TFS 存储库</li>
<li>将 Visual Studio Web 应用程序连接到 TFS</li>
<li>从 Microsoft Visual Studio 2012 签入到 TFS 并在网站中反映更改</li>
</ul>

<p><a name="Prerequisites"></a></p>

<h3 id="Prerequisites">先决条件</h3>

<ul>
<li><p><a href="http://www.microsoft.com/visualstudio/">Microsoft Visual Studio 2012 Express for Web</a> 或更高版本</p></li>
<li><p>启用了网站预览的 Windows Azure 订阅 - <a href="http://aka.ms/WATK-FreeTrial">注册以免费试用</a></p></li>
</ul>
<blockquote>
<p><strong>注意：</strong>此动手实验针对 Windows 8 而设计。</p>
</blockquote>
<p><a name="Setup"></a></p>

<h3 id="Setup">设置</h3>

<p>为了执行此动手实验中的各项练习，需要对环境进行设置。</p>

<ol>
<li><p>打开 Windows 资源管理器窗口，浏览到此实验的 <strong>Source</strong> 文件夹。</p></li>
<li><p>右键单击 <strong>Setup.cmd</strong> 文件，然后单击<strong>“以管理员身份运行”</strong>。这将启动设置过程，该过程将检查必要的依赖项。</p></li>
</ol>
<blockquote>
<p><strong>注意：</strong>请务必在运行安装程序前检查此实验的所有依赖项。</p>
</blockquote>
<hr />

<p><a name="Exercises"></a></p>

<h2 id="Exercises">练习</h2>

<p>此动手实验包括以下练习：</p>

<ol>
<li> <a href="#Exercise1">创建 Windows Azure 网站</a></li>
<li> <a href="#Exercise2">将 Windows Azure 网站连接到 TFS 项目</a></li>
<li> <a href="#Exercise3">将 Microsoft Visual Studio 2012 连接到 TFS 存储库</a></li>
</ol>

<p>完成此实验的估计时间：<strong>30</strong> 分钟。</p>

<p><a name="Exercise1"></a></p>

<h3 id="Exercise_1_Create_a_Windows_Azure_Web_Site">练习 1：创建 Windows Azure 网站</h3>

<p>在本练习中，您将使用 <strong>Windows Azure 管理门户</strong>创建一个新网站。在接下来的练习中，您将使用这一网站通过 TFS 签入操作发布 MVC4 应用程序。</p>

<p><a name="Ex1Task1"></a></p>

<h4 id="Task_1_-_Creating_a_new_Web_Site">任务 1 - 创建新网站</h4>

<p>在此任务中，您将从 Windows Azure 管理门户创建一个新网站。</p>

<ol>
<li><p>打开 <a href="https://manage.windowsazure.com">Windows Azure 管理门户</a>并使用您的 Windows Azure 帐户凭据登录。</p></li>
<li><p>依次单击<strong>“新建”</strong>|<strong>“计算”</strong>|<strong>“网站”</strong>|<strong>“快速创建”</strong>。为您的网站选择一个唯一的 <strong>URL</strong>，例如 <em>WebSitesAndTFS</em>。</p>

<p><img src="Images/creating-a-new-web-site.png?raw=true" alt="创建新网站" title="创建新网站" />
</p>

<p><em>创建新网站</em></p></li>
<li><p>在 <strong>Windows Azure 管理门户</strong>中单击<strong>“网站”</strong>，然后单击您的网站的<strong>名称</strong>进入该网站的<strong>面板</strong>。</p>

<p><img src="Images/web-sites-page.png?raw=true" alt="网站页" title="网站页" />
</p>

<p><em>网站页</em></p></li>
<li><p>这就是您的网站的<strong>“面板”</strong>页，从这里可以管理网站设置和查找所有网站相关信息。请不要关闭此窗口，下一练习中还要使用。</p>

<p><img src="Images/web-sites-dashboard.png?raw=true" alt="网站面板" title="网站面板" />
</p>

<p><em>网站面板</em></p></li>
</ol>

<p><a name="Exercise2"></a></p>

<h3 id="Exercise_2_Connecting_a_Windows_Azure_Web_Site_to_a_TFS_Project">练习 2：将 Windows Azure 网站连接到 TFS 项目</h3>

<p>在本练习中，要将您的 Windows Azure 网站链接到一个 TFS 项目。这样，您就可以签入更改并自动更新您的网站。</p>

<p><a name="Ex2Task1"></a></p>

<h4 id="Task_1_-_Connecting_a_Windows_Azure_Web_Site_to_a_TFS_Project">任务 1 - 将 Windows Azure 网站连接到 TFS 项目</h4>

<p>在此任务中，您要将 Windows Azure 网站连接到一个 TFS 项目。可以在 TFS 中创建新帐户和项目，也可以使用现有帐户和项目。</p>

<ol>
<li><p>如果尚未打开 <a href="https://manage.windowsazure.com">Windows Azure 管理门户</a>，请将其打开并转到您的网站的<strong>面板</strong>。</p></li>
<li><p>单击页面底部的<strong>“设置 TFS 发布”</strong>链接。</p>

<p><img src="Images/setting-up-tfs-publishing.png?raw=true" alt="设置 TFS 发布" title="设置 TFS 发布" />
</p>

<p><em>设置 TFS 发布</em></p></li>
<li><p>现在，您将配置要链接到网站的 TFS 帐户。如果您已经有 TFS 帐户，请直接转到此任务的<strong>步骤 12</strong>，否则，请单击<strong>“立即创建一个 TFS 帐户”</strong>。</p>
<blockquote>
<p><strong>注意：</strong>如果选择使用现有用户，请确保您有可用的团队项目。</p>
</blockquote>
<p><img src="Images/creating-a-new-tfs-account.png?raw=true" alt="创建新 TFS 帐户" title="创建新 TFS 帐户" />
</p>

<p><em>创建新 TFS 帐户</em></p></li>
<li><p>在<strong>“帐户创建”</strong>页中，选择<em>“Windows Live ID”</em>作为<strong>“标识提供程序”</strong>，并为您的 TFS 服务器设置<strong>“服务器 URL”</strong>（例如，<em>WebSitesAndTFSServer</em>）。单击<strong>“创建帐户”</strong>继续。</p>

<p><img src="Images/tfs-new-account-registration.png?raw=true" alt="TFS 新帐户注册" title="TFS 新帐户注册" />
</p>

<p><em>TFS 新帐户注册</em></p></li>
<li><p>如果您尚未使用所选的标识提供程序登录，TFS 将要求您登录。</p></li>
<li><p>进入 TFS 帐户主页后，请单击<strong>“创建团队项目”</strong>以生成一个新的 TFS 项目。</p>

<p><img src="Images/create-a-team-project.png?raw=true" alt="TFS 服务器主页" title="TFS 服务器主页" />
</p>

<p><em>TFS Server 主页</em></p></li>
<li><p>在<strong>“新建团队项目”</strong>对话框中，将<strong>“项目名称”</strong>设置为 <em>WebSitesAndTFSProject</em>，添加项目<strong>“说明”</strong>并保留<strong>“过程模板”</strong>的默认值。然后，单击<strong>“创建项目”</strong>。</p>

<p><img src="Images/creating-a-new-team-project.png?raw=true" alt="新建团队项目" title="新建团队项目" />
</p>

<p><em>新建团队项目</em></p></li>
<li><p>等待 TFS 项目创建完成。</p>

<p><img src="Images/project-creation-process.png?raw=true" alt="项目创建过程" title="项目创建过程" />
</p>

<p><em>项目创建过程</em></p></li>
<li><p>创建过程结束后，单击<strong>“导航到项目”</strong>。您将看到该 TFS 项目的主页。</p>

<p><img src="Images/tfs-project-page.png?raw=true" alt="TFS 项目页" title="TFS 项目页" />
</p>

<p><em>TFS 项目页</em></p></li>
<li><p>复制 TFS 服务器的 <strong>URL</strong> 前缀并关闭窗口。</p></li>
<li><p>返回到网站<strong>“面板”</strong>，将 TFS 服务器的 URL 前缀粘贴到<strong>“现有 TFS 用户”</strong>字段中，然后单击<strong>“立即授权”</strong>。</p>

<p><img src="Images/tfs-account-information.png?raw=true" alt="TFS 帐户 URL" title="TFS 帐户 URL" />
</p>

<p><em>TFS 帐户 URL</em></p></li>
<li><p>此时会弹出一个新窗口，请求将网站项目链接到 TFS 项目的权限。请单击<strong>“接受”</strong>允许您的网站使用指定的 TFS 帐户。</p>

<p><img src="Images/requesting-tfs-project-access.png?raw=true" alt="请求 TFS 项目访问" title="请求 TFS 项目访问" />
</p>

<p><em>请求 TFS 项目访问</em></p></li>
<li><p>在<strong>“设置从项目发布”</strong>页上，从<strong>“选择要发布的团队项目”</strong>下拉列表中选择 TFS 项目。</p>

<p><img src="Images/choosing-your-tfs-project.png?raw=true" alt="选择您的 TFS 项目" title="选择您的 TFS 项目" />
</p>

<p><em>选择您的 TFS 项目</em></p></li>
<li><p>最后，在<strong>“部署”</strong>页上可以看到一条消息，显示已成功链接 TFS 项目。</p>

<p><img src="Images/tfs-project-linked.png?raw=true" alt="TFS 项目已链接" title="TFS 项目已链接" />
</p>

<p><em>TFS 项目已链接</em></p></li>
</ol>

<p><a name="Exercise3"></a></p>

<h3 id="Exercise_3_Connecting_Microsoft_Visual_Studio_2012_to_a_TFS_Repository">练习 3：将 Microsoft Visual Studio 2012 连接到 TFS 存储库</h3>

<p>在本练习中，您将创建一个简单的 MVC4 应用程序，将该应用程序连接到 TFS 存储库并签入您的文件，所有这些都使用 <strong>Microsoft Visual Studio Express 2012 for Web</strong> 完成。</p>

<p><a name="Ex3Task1"></a></p>

<h4 id="Task_1_-_Connecting_Microsoft_Visual_Studio_2012_to_a_TFS_Repository">任务 1 - 将 Microsoft Visual Studio 2012 连接到 TFS 存储库</h4>

<p>在此任务中，您将使用 Microsoft Visual Studio Express 2012 for Web 创建一个 MVC4 应用程序，将该应用程序连接到 TFS 存储库，并将您的文件签入 TFS 存储库。</p>

<ol>
<li><p>在您的网站的<strong>“面板”</strong>页上，找到并单击 <strong>Visual Studio</strong> 图标。单击此图标将打开 Microsoft Visual Studio Express 2012 for Web，并将它直接连接到在上一练习中链接的 TFS 存储库。</p>

<p><img src="Images/opening-visual-studio.png?raw=true" alt="打开 Visual Studio" title="打开 Visual Studio" />
</p>

<p><em>打开 Visual Studio</em></p></li>
<li><p>Visual Studio 可能会启动一个对话框，要求您登录您的 TFS 项目。如果是，请输入创建 TFS 项目时使用的凭据。</p></li>
<li><p>在 Microsoft Visual Studio Express 2012 for Web 中创建一个新的 <strong>ASP.NET MVC 4</strong> 项目。为此，请选择<strong>“文件”</strong>|<strong>“新建项目”</strong>。</p></li>
<li><p>在<strong>“新建项目”</strong>对话框中，从<strong>“Visual C# Web”</strong>模板中选择<strong>“ASP.NET MVC 4 Web 应用程序”</strong>，并将 <em>.NET Framework 4.5</em> 设置为<strong>“目标框架”</strong>。将其命名为 <em>MyMVC4App</em>，然后单击<strong>“确定”</strong>。</p>

<p><img src="Images/new-aspnet-mvc-4-project.png?raw=true" alt="新建 ASP.NET MVC 4 项目" title="新建 ASP.NET MVC 4 项目" />
</p>

<p><em>新建 ASP.NET MVC 4 项目</em></p></li>
<li><p>在<strong>“新建 ASP.NET MVC 4 项目”</strong>对话框中选择<strong>“Internet 应用程序”</strong>模板，然后单击<strong>“确定”</strong>。</p>

<p><img src="Images/mvc4-project-template.png?raw=true" alt="MVC4 项目模板" title="MVC4 项目模板" />
</p>

<p><em>MVC ASP.NET MVC 4</em></p></li>
<li><p>在<strong>解决方案资源管理器</strong>中，右键单击解决方案并选择<strong>“将解决方案添加到源代码管理”</strong>。</p>

<p><img src="Images/adding-solution-to-source-control.png?raw=true" alt="将解决方案添加到源代码管理" title="将解决方案添加到源代码管理" />
</p>

<p><em>将解决方案添加到源代码管理</em></p></li>
<li><p>在<strong>“将解决方案添加到源代码管理”</strong>对话框中，选择您的团队项目节点以便将 Web 项目添加到团队项目，再单击<strong>“确定”</strong>。</p>

<p><img src="Images/adding-solution-to-team-project.png?raw=true" alt="将解决方案添加到团队项目" title="将解决方案添加到团队项目" />
</p>

<p><em>将解决方案添加到团队项目</em></p></li>
<li><p>将项目添加到源代码管理之后，解决方案资源管理器就会反映需要将文件签入 TFS。</p>

<p><img src="Images/project-added-to-tfs.png?raw=true" alt="项目已添加到 TFS" title="项目已添加到 TFS" />
</p>

<p><em>项目已添加到 TFS</em></p></li>
<li><p>在 Microsoft Visual Studio 2012 中，切换到<strong>“团队资源管理器”</strong>选项卡并选择<strong>“挂起的更改”</strong>。</p>

<p><img src="Images/team-explorer.png?raw=true" alt="团队资源管理器" title="团队资源管理器" />
</p>

<p><em>团队资源管理器</em></p></li>
<li><p>在<strong>“团队资源管理器 - 挂起的更改”</strong>窗格中，为签入输入一条<strong>“注释”</strong>，然后单击<strong>“签入”</strong>提交文件。</p>

<p><img src="Images/team-explorer-pending-changes.png?raw=true" alt="团队资源管理器 - 挂起的更改" title="团队资源管理器 - 挂起的更改" />
</p>

<p><em>团队资源管理器 - 挂起的更改</em></p></li>
<li><p>如果出现<strong>“签入确认”</strong>对话框，请单击<strong>“是”</strong>。</p></li>
<li><p>等待签入完成。完成后将在窗格顶部显示一条指示成功的消息。</p>

<p><img src="Images/check-in-complete.png?raw=true" alt="签入完成" title="签入完成" />
</p>

<p><em>签入完成</em></p></li>
</ol>

<p><a name="Ex3Task2"></a></p>

<h4 id="Task_2_-_Checking_in_changes_to_TFS_and_updating_the_Web_Site">任务 2 - 将更改签入 TFS 并更新网站</h4>

<p>在此任务中，您将更新 MVC 4 应用程序，并将更改签入 TFS 中。此外，还将在 TFS 中创建一个新的<strong>“生成定义”</strong>以自动生成和更新您的网站。</p>

<ol>
<li><p>在<strong>解决方案资源管理器</strong>中打开位于 <strong>Views/Shared</strong> 文件夹中的 <strong>_Layout.cshtml</strong> 文件。将内容为 <em>your logo here</em> 的代码行替换为<em>“我的 TFS 生成的应用程序”</em>，并保存更改。</p>

<p><img src="Images/updating-layout-view.png?raw=true" alt="更新布局视图" title="更新布局视图" />
</p>

<p><em>更新布局视图</em></p></li>
<li><p>切换到<strong>“团队资源管理器”</strong>选项卡，并使用新的<strong>“注释”</strong>来<strong>签入</strong>更改。</p>

<p><img src="Images/updating-layout-view2.png?raw=true" alt="更新布局视图" title="更新布局视图" />
</p>

<p><em>更新布局视图</em></p></li>
<li><p>打开<strong>“团队资源管理器”</strong>的菜单并选择<strong>“生成”</strong>，以查看来自 Visual Studio 的生成状态。</p>

<p><img src="Images/switching-to-builds.png?raw=true" alt="切换到生成详细信息" title="切换到生成详细信息" />
</p>

<p><em>切换到生成详细信息</em></p></li>
<li><p>返回到 <strong>TFS Online</strong> 应用程序。为此，请找到网站<strong>“面板”</strong>中的<strong>“TFS 项目”</strong>链接。</p>

<p><img src="Images/accessing-tfs-project.png?raw=true" alt="访问 TFS 项目" title="访问 TFS 项目" />
</p>

<p><em>访问 TFS 项目</em></p></li>
<li><p>在 <strong>TFS Online</strong> 应用程序中，单击<strong>“生成”</strong>选项卡。应该看到有一个新生成在排队等候。等待此生成完成（可能需要手动刷新页面才能反映更改）。</p>

<p><img src="Images/build-queued.png?raw=true" alt="生成排队等候" title="生成排队等候" />
</p>

<p><em>生成排队等候</em></p>

<p><img src="Images/build-completed.png?raw=true" alt="生成完成" title="生成完成" />
</p>

<p><em>生成完成</em></p>
<blockquote>
<p><strong>注意：</strong>TFS 生成将自动编译并将您的更改发布到网站，从而显著简化对 Windows Azure 网站的更新。</p>
</blockquote></li>
<li><p>返回到<strong>“Windows Azure 管理门户”</strong>，进入您的网站的<strong>“面板”</strong>页。单击<strong>“面板”</strong>页底部的<strong>“浏览”</strong>。</p>

<p><img src="Images/browse-the-web-site.png?raw=true" alt="浏览网站" title="浏览网站" />
</p>

<p><em>浏览网站</em></p></li>
<li><p>网站将打开，其中反映了您提交到 TFS 项目的更改。</p>

<p><img src="Images/application-running.png?raw=true" alt="运行中的应用程序" title="运行中的应用程序" />
</p>

<p><em>运行中的应用程序</em></p></li>
</ol>

<hr />

<p><a name="Summary"></a></p>

<h2 id="Summary">小结</h2>

<p>在此动手实验中，您学习了如何将 Windows Azure 网站链接到 Team Foundation Service (TFS) 存储库，以便签入更改并在您的网站中自动反映这些更新。您从 Windows Azure 管理门户创建了一个新网站，并为其启用了 TFS 发布。您在 Visual Studio 2012 中创建了一个简单的 MVC4 应用程序，然后签入到 TFS 服务器。另外，您还演示了在更新 TFS 存储库后，Windows Azure 网站中如何自动反映了您所做的更改。</p> </span>
		</div>
	<br/>
	<p><a href="#top">返回页首</a></p>


				</div>
			</section>
			<footer>
				<div class="footer-sitemap" style="border-top:0"></div>
				<div class="footer-bottom">
					<ul>
						<li class="footer-copyright"><a href="http://www.microsoft.com"><img alt="microsoft" src="images/microsoft.png" /></a></li>					
												<li><a href="https://github.com/WindowsAzure-TrainingKit/HOL-ASPNETAzureWebSitesTFS/issues" target="_new">记录问题</a></li>
												<li><a href="mailto:azcfeed@microsoft.com?subject=Windows Azure Training Kit">联系我们</a></li>
						<li><a href="EULA.htm">使用条款</a></li>
						<li><a href=".\">浏览内容</a></li>
						<li>&copy; 2012 Microsoft</li>
					</ul>
				</div>
			</footer>
			</div>
        </div>
    </div>
</body>
</html>

