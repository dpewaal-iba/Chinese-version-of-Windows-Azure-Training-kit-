<!DOCTYPE html>

<html class="no-js" lang="en" class="js flexbox canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths">
<head id="ContentPlaceHolderDefault_Head1">
    <meta http-equiv="X-UA-Compatible" content="IE=9,chrome=1" />
    <meta charset=UTF-8" />
    <title>Windows Azure 培训包 - Windows Azure 虚拟机简介 (Linux)</title>
    <link rel="Stylesheet" type="text/css" media="all" href="styles/master.css" />
</head>
<body id="top" class="page-">
    <div id="page">
        <div id="wrapper" class="landingPage getStartedPage">            
            <div class="header">								
				<img alt="Windows Azure" src="images/azure-logo.png" /> <span class="mainHomepageSubTitle">培训包 - 2013 年 4 月更新</span>								
			</div>			
			<div class="nav-menu-header">
				<nav>
					<ul>
						<li class="MenuLink-Selected">
							<a href="#">内容</a>
						</li>
											</ul>
				
										
						<span id="github-btn" class="github-btn"> <a id="gh-btn" title="在 GitHub 中复制此存储库的分支" href="https://github.com/WindowsAzure-TrainingKit/HOL-IntroToWindowsAzureVirtualMachinesLinux" target="_blank" class="gh-btn"> <span class="gh-ico"></span> <span id="gh-text" class="gh-text">分支</span> </a> </span> <span id="github-btn" class="github-btn github-watchers"> <a id="gh-btn" title="在 GitHub 中关注此存储库" href="https://github.com/WindowsAzure-TrainingKit/HOL-IntroToWindowsAzureVirtualMachinesLinux" target="_blank" class="gh-btn"> <span class="gh-ico"></span> <span id="gh-text" class="gh-text">关注</span> </a> </span>
						
									
				</nav>
			</div>	        
		</span>
			<div id="content" class="textpage">
            <section id="content-container">
				<div id="content" class="textpage">
			    <a name="top"></a>
				
				

		<div class="content">
			<?xml version="1.0" encoding="iso-8859-1"?><span><p><a name="handsonlab"></a></p>

<h1 id="Introduction_to_Windows_Azure_Virtual_Machines_Linux">Windows Azure 虚拟机简介 (Linux)</h1>

<hr />

<p><a name="Overview"></a></p>

<h2 id="Overview">概述</h2>

<p>使用 Windows Azure 作为 IaaS 平台，让您能够迅速创建并管理基础结构，随处设置和访问任何主机。通过基于云的基础结构实现业务增长，降低许可、设置和备份的成本。</p>

<p>在此动手实验中，您将学习如何使用 Windows Azure IaaS 平台在云中设置基于 Linux 的虚拟机和从远程管理它。</p>

<p><a name="Objectives"></a></p>

<h3 id="Objectives">目标</h3>

<p>在此动手实验中，您将学习如何执行以下操作：</p>

<ul>
<li>在 Windows Azure 中创建 Linux 虚拟机</li>
<li>使用 MySql 安装和配置 Apache Web 服务器</li>
<li>安装和配置 Drupal CMS</li>
</ul>

<p><a name="Prerequisites"></a></p>

<h3 id="Prerequisites">先决条件</h3>

<ul>
<li>Windows Azure 订阅 - <a href="http://aka.ms/WATK-FreeTrial">注册以免费试用</a></li>
</ul>
<blockquote>
<p><strong>注意：</strong>此动手实验设计为在 Windows Azure 中创建新的虚拟机时使用 <strong>OpenSUSE</strong> linux 分发。</p>
</blockquote>
<hr />

<p><a name="Exercises"></a></p>

<h2 id="Exercises">练习</h2>

<p>此动手实验包括以下练习：</p>

<ol>
<li><p><a href="#Exercise1">在 Windows Azure 中创建 Linux 虚拟机</a></p></li>
<li><p><a href="#Exercise2">安装和配置虚拟机</a></p></li>
<li><p><a href="#Exercise3">安装和配置 Drupal</a></p></li>
</ol>

<p>完成此实验的估计时间：<strong>45 分钟</strong>。</p>

<hr />

<p><a name="Exercise1"></a></p>

<h3 id="Exercise_1_Creating_a_Linux_Virtual_Machine_in_Windows_Azure">练习 1：在 Windows Azure 中创建 Linux 虚拟机</h3>

<p>在此练习中，您将学习如何在 Azure 门户中设置 Linux 虚拟机。</p>

<p><a name="Ex1Task1"></a></p>

<h4 id="Task_1_-_Creating_a_New_Linux_Virtual_Machine">任务 1 - 新建 Linux 虚拟机</h4>

<ol>
<li>打开 Internet Explorer 并浏览 <a href="https://manage.windowsazure.com"><a href="https://manage.windowsazure.com">https://manage.windowsazure.com</a></a> 以进入 Windows Azure 门户。然后，使用您的凭据登录。</li>
<li><p>在位于底部的菜单中，选择<strong>“计算”</strong>|<strong>“新建虚拟机”|“从库中”</strong>开始新建虚拟机。</p>

<p><img src="Images/creating-a-new-virtual-machine.png?raw=true" alt="新建虚拟机" />
</p>

<p><em>新建虚拟机</em></p></li>
<li><p>在<strong>“选择虚拟机操作系统”</strong>页中，单击左侧菜单中的<strong>“平台映像”</strong>，然后从列表中选择 <strong>OpenSUSE</strong> 操作系统映像。单击箭头继续。</p>

<p><img src="Images/creating-a-vm-suse.png?raw=true" alt="从映像列表中选择 OpenSUSE" />
   </p>

<p><em>从映像列表中选择 OpenSUSE</em></p></li>
<li><p>在<strong>“虚拟机配置”</strong>页中，输入<strong>“虚拟机名称”</strong>，为<strong>“新用户名”</strong>字段提供一个用户名，为<strong>“新密码”</strong>和<strong>“确认密码”</strong>字段提供一个密码。最后，将虚拟机的<strong>“大小”</strong>设置为<em>“小”</em>，然后单击<strong>“下一步”</strong>继续。</p>

<p><img src="Images/creating-a-vm-configuration.png?raw=true" alt="配置自定义虚拟机" />
 </p>

<p><em>创建虚拟机 - 配置</em></p>
<blockquote>
<p><strong>注意：</strong>建议对管理用户使用安全密码，因为只要知道 Windows Azure 虚拟机的 DNS 就可以从 Internet 访问它们。</p>

<p>您也可以阅读 Microsoft 安全网站上的以下文档帮助选择安全密码：<a href="http://www.microsoft.com/security/online-privacy/passwords-create.aspx"><a href="http://www.microsoft.com/security/online-privacy/passwords-create.aspx">http://www.microsoft.com/security/online-privacy/passwords-create.aspx</a></a></p>
</blockquote></li>
<li><p>在<strong>“虚拟机模式”</strong>页中，选择<strong>“独立虚拟机”</strong>，输入 <strong>DNS 名称</strong>，您可以自动生成一个新的存储帐户或者选择已拥有的存储帐户。然后，选择<strong>“区域/地缘组/虚拟网络”</strong>值并且选择<strong>订阅</strong>。单击<strong>向右箭头</strong>继续。</p>

<p><img src="Images/creating-a-vm-vm-mode.png?raw=true" alt="配置自定义虚拟机，虚拟机模式" />
</p>

<p><em>创建虚拟机 - 虚拟机模式</em></p></li>
<li><p>在<strong>“虚拟机选项”</strong>页中，单击按钮以便新建虚拟机。</p>

<p><img src="Images/creating-a-vm--vm-options.png?raw=true" alt="创建虚拟机 - 虚拟机选项" title="创建虚拟机 - 虚拟机选项" />
</p>

<p><em>创建虚拟机 - 虚拟机选项</em></p></li>
<li><p>在<strong>“虚拟机”</strong>部分中，您将看到所创建的虚拟机具有<em>“正在配置”</em>状态。等待状态变为<em>“正在运行”</em>，然后再继续后面的步骤。</p>

<p><img src="Images/creating-linux-vm.png?raw=true" alt="创建 Linux 虚拟机" />
</p>

<p><em>创建 Linux 虚拟机</em></p></li>
<li><p>现在，您将创建管理虚拟机所需的端点。为此，选择虚拟机以转到<strong>“仪表板”</strong>页，然后单击<strong>“端点”</strong>。</p></li>
<li><p>单击<strong>“添加端点”</strong>，选择<strong>“添加端点”</strong>选项，然后单击<strong>右箭头</strong>继续。</p>

<p><img src="Images/adding-a-new-endpoint.png?raw=true" alt="添加新端点" title="添加新端点" />
</p>

<p><em>添加新端点</em></p></li>
<li><p>在<strong>“指定端点详细信息”</strong>页中，将<strong>“名称”</strong>设置为 <em>webport</em>，<strong>“协议”</strong>设置为 <em>TCP</em>，<strong>“公用端口”</strong>和<strong>“专用端口”</strong>设置为 <em>80</em>。</p>

<p><img src="Images/new-endpoint-details.png?raw=true" alt="新端点详细信息" title="新端点详细信息" />
</p>

<p><em>指定端点详细信息</em></p>
<blockquote>
<p><strong>注意：</strong>此端点启用端口 80，在以下任务中 Apache 服务器将使用该端口。</p>
</blockquote></li>
</ol>

<p><a name="Ex1Task2"></a></p>

<h4 id="Task_2_-_Verification_Connecting_to_the_Virtual_Machine_by_using_a_SSH_client">任务 2 - 验证：通过使用 SSH 客户端连接到虚拟机</h4>

<p>现在，您已设置和配置了 Linux 虚拟机，将通过使用 SSH 客户端进行连接。</p>
<blockquote>
<p><strong>注意：</strong>您可以从下面的网址下载 Putty，这是用于 Windows 的一个免费的 SSH 客户端：<a href="http://www.putty.org/"><a href="http://www.putty.org/">http://www.putty.org/</a></a></p>
</blockquote>
<ol>
<li><p>在 Windows Azure 门户中，从列表中选择 Linux 虚拟机以便进入<strong>“仪表板”</strong>。记下“速览”部分的<strong>“SSH 详细信息”</strong>字段，这是一个公共地址，用于通过使用 SSH 客户端访问和连接到虚拟机。</p>

<p><img src="Images/ssh-endpoint.png?raw=true" alt="SSH 端点" title="SSH 端点" />
</p>

<p><em>SSH 端点</em></p></li>
<li><p>使用来自前一步骤的地址和端口，打开 Putty 客户端（或者任何其他 SSH 客户端）并且创建与虚拟机的新连接。</p>

<p><img src="Images/connecting-to-the-linux-vm-via-putty-client.png?raw=true" alt="通过 Putty 客户端连接到 Linux 虚拟机" />
</p>

<p><em>通过 Putty 客户端连接到 Linux 虚拟机</em></p>
<blockquote>
<p><strong>注意：</strong>您可以在虚拟机的<strong>“端点”</strong>部分中验证 SSH 连接的公共端口。在使用 Putty 时，确保您启用 TCP Keepalive 并且将其设置为大于 5 的值。</p>
</blockquote></li>
<li><p>使用虚拟机凭据登录。</p>
<blockquote>
<p><strong>注意：</strong>在完成密码时，光标将不会移动</p>
</blockquote>
<p><img src="Images/logging-in-to-the-linux-virtual-machine.png?raw=true" alt="登录到 Linux 虚拟机" />
</p>

<p><em>登录到 Linux 虚拟机</em></p></li>
<li><p>执行以下命令以便以<strong>管理员</strong>权限进行模拟。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">sudo su -
</code></pre>

<p><img src="Images/logging-in-with-administrator-rights.png?raw=true" alt="以管理员权限登录" />
</p>

<p><em>以管理员权限登录</em></p></li>
</ol>

<hr />

<p><a name="Exercise2"></a></p>

<h3 id="Exercise_2_Installing_and_Configuring_the_Virtual_Machine">练习 2：安装和配置虚拟机</h3>

<p>在此练习中，您将学习如何通过使用 SSH 客户端在 Linux 虚拟机中安装和配置 Web 服务器。首先，您将通过使用 Yast2 应用程序安装 Apache Web 服务器和 MySQL 数据库服务器。然后，您将配置虚拟机并且创建一个示例数据库。</p>
<blockquote>
<p><strong>注意：</strong>如果您尚未运行练习 1，则在继续执行练习 2 之前请确保已具有以下项：</p>

<ul>
<li>在 Windows Azure 门户中创建的 Linux 虚拟机。</li>
<li>启用了专用端口 22 的 TCP 端点。</li>
<li>在端口 80 中启用的 TCP 端点。</li>
</ul>
</blockquote>
<p><a name="Ex2Task1"></a></p>

<h4 id="Task_1_-_Installing_and_Configuring_Apache_and_MySQL">任务 1 - 安装和配置 Apache 和 MySQL</h4>

<p>在此任务中，您将安装和配置 Apache HTTP 服务器和 MySQL 数据库管理系统。</p>

<ol>
<li><p>安装 <strong>Yast2</strong>。在终端中，执行以下命令以便安装所需包。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">zypper install yast2 zypper install yast2-ncurses zypper install yast2-ncurses-pkg zypper install yast2-qt zypper install yast2-gtk zypper install yast2-packager zypper install yast2-network zypper install yast2-http-server zypper install yast2-runlevel
</code></pre>
<blockquote>
<p><strong>注意</strong>：如果系统显示以下提示“是要拒绝该键、暂时信任还是始终信任？[r/t/a/?]”，则按下 a，然后按 Enter 键。</p>
</blockquote></li>
<li><p>若要安装针对 Drupal 的必备组件，您将使用 <strong>Yast2</strong> 自动安装 Apache 和 MySQL 及其依赖项。在终端中，执行 <strong>Yast2</strong>。这将打开 <strong>Yast2</strong> 应用程序。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">yast2
</code></pre></li>
<li><p>使用键盘上的箭头键选择<strong>“软件”</strong>，按右箭头并且选择<strong>“软件管理”</strong>，然后点击 <strong>ENTER</strong>。</p>

<p><img src="Images/yast2-control-center.png?raw=true" alt="YaST2 控制中心" />
</p>

<p><em>YaST2 中的软件管理</em></p></li>
<li><p>按 <strong>ALT+F</strong> 更改筛选器类型并且选择<strong>“模式”</strong>。</p>

<p><img src="Images/selecting-the-patterns-filter.png?raw=true" alt="选择模式筛选器" />
</p>

<p><em>选择模式筛选器</em></p></li>
<li><p>向下滚动选项，直到找到<strong>“Web 和 LAMP 服务器”</strong>。按 <strong>ENTER</strong> 选择该项，然后按 <strong>ALT+T</strong> 选择<strong>“所有列出的包...”</strong>和<strong>“全部安装”</strong>。</p>
<blockquote>
<p><strong>注意</strong>：在按下 Enter 后，您将会在屏幕左侧上的 Web 和 Lamp 服务器旁看到一个加号</p>
</blockquote>
<p><img src="Images/installing-web-and-lamp-server.png?raw=true" alt="安装 Web 和 LAMP 服务器" />
</p>

<p><em>安装 Web 和 LAMP 服务器</em></p></li>
<li><p>按下 <strong>ALT+A</strong> 开始安装。在系统提示您确认时按 <strong>ENTER</strong>。</p></li>
<li><p>在安装完成后，程序将会引导您返回主菜单。再次进入<strong>“软件管理”</strong>。键入 <strong>php5-json</strong> 搜索此包并且点击 <strong>ENTER</strong> 以便选择它。按下 <strong>ALT+A</strong> 开始安装。</p>

<p><img src="Images/installing-php-extensions.png?raw=true" alt="安装 PHP 扩展插件" />
</p>

<p><em>安装 PHP 扩展插件</em></p></li>
<li><p>返回到主菜单，按下左箭头键并且选择<strong>“网络服务”</strong>。按下右箭头键，选择<strong>“HTTP 服务器”</strong>并且按 <strong>ENTER</strong>。</p>

<p><img src="Images/configuring-http-server.png?raw=true" alt="配置 HTTP 服务器" />
</p>

<p><em>配置 HTTP 服务器</em></p></li>
<li><p>通过在每个步骤上按下 <strong>F10</strong> 完成向导步骤，以便使用默认值完成配置。</p>

<p><img src="Images/http-service-setup-wizard.png?raw=true" alt="HTTP 服务设置向导" title="HTTP 服务设置向导" />
</p>

<p><em>HTTP 服务设置向导</em></p></li>
<li><p>选择<strong>“网络服务”</strong>并且再次选择<strong>“HTTP 服务器”</strong>。按 <strong>ALT+E</strong> 启用 HTTP 服务，然后按 <strong>ALT+F</strong> 确认更改。</p>

<p><img src="Images/enabling-http-service.png?raw=true" alt="启用 HTTP 服务" />
</p>

<p><em>启用 HTTP 服务</em></p></li>
<li><p>返回到主菜单，按下左箭头键并且从菜单选项中选择<strong>“系统”</strong>。按下右箭头键，然后选择<strong>“系统服务(Runlevel)”</strong>并且按 <strong>ENTER</strong>。</p>

<p><img src="Images/configuring-system-services.png?raw=true" alt="配置系统服务" />
</p>

<p><em>配置系统服务</em></p></li>
<li><p>向下滚动直到找到 <strong>mysql</strong>，然后按 <strong>ALT+E</strong> 启用该服务。等到该服务运行，然后在确认消息上按 <strong>Enter</strong>。</p>

<p><img src="Images/enabling-mysql-service.png?raw=true" alt="启用 MySQL 服务" />
</p>

<p><em>启用 MySQL 服务</em></p></li>
<li><p>找到 <strong>apache2</strong>，然后按 <strong>ALT+E</strong> 也启用该服务。等到该服务运行，然后在确认消息上按 <strong>Enter</strong>。按 <strong>F10</strong> 以保存设置。</p></li>
<li><p>按 <strong>ALT+Q</strong> 退出 <strong>YaST2</strong>。</p></li>
</ol>

<hr />

<p><a name="Exercise3"></a></p>

<h3 id="Exercise_3_-_Installing_and_Configuring_Drupal">练习 3 - 安装和配置 Drupal</h3>

<p>在此练习中，您将在 Linux 虚拟机中安装和配置 Drupal CMS。在练习结束时，您将能够承载一个 Drupal CMS 网站。</p>
<blockquote>
<p><strong>注意：</strong>在开始此练习前，请确保已完成了练习 2。</p>
</blockquote>
<p><a name="Ex3Task1"></a></p>

<h4 id="Task_1_-_Installing_and_Configuring_Drupal">任务 1 - 安装和配置 Drupal</h4>

<p>在此任务中，您将在 Windows Azure Linux 虚拟机中安装和配置一个 Drupal 门户。此外，您将创建要由 Drupal CMS 使用的一个空数据库。</p>

<ol>
<li><p>打开根网站文件夹，并且通过执行以下命令创建名为 <strong>drupal</strong> 的一个文件夹。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">cd /srv/www/htdocs mkdir drupal cd drupal
</code></pre></li>
<li><p>执行以下命令来安装 <strong>wget</strong>。</p>

<span class="codelanguage">Bash</span><pre><code class="Bash">zypper install wget
</code></pre></li>
<li><p>下载并提取 <strong>Drupal</strong>。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">wget http://drupal.org/files/projects/drupal-7.10.tar.gz tar -xzf drupal-7.10.tar.gz --strip-components=1 
</code></pre>

<p><img src="Images/downloading-drupal.png?raw=true" alt="下载 Drupal" />
</p>

<p><em>下载 Drupal</em></p></li>
<li><p>复制位于 <strong>sites/default</strong> 目录中的 <strong>default.settings.php</strong> 文件，然后将复制的命令重命名为 <strong>settings.php</strong>。此外，向该配置文件提供 Web 服务器写入权限。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">cp sites/default/default.settings.php sites/default/settings.php chmod a+w sites/default/settings.php chmod a+w sites/default
</code></pre>

<p><img src="Images/creating-the-configuration-file-and-granting.png?raw=true" alt="创建配置文件并且授予权限" />
</p>

<p><em>创建配置文件并且授予权限</em></p></li>
<li><p>若要完成安全，请在 <strong>MySQL</strong> 中为 <strong>Drupal</strong> 创建一个空数据库。执行以下操作：</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">mysqladmin create drupaldb
</code></pre></li>
<li><p>执行 <strong>mysql</strong>。在 MySQL 提示符后，执行以下查询。使用您的用户帐户替代 <strong>username</strong> 和 <strong>password</strong>。</p>

<span class="codelanguage">Linux</span><pre><code class="Linux">GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES ON drupaldb.* TO 'username'@'localhost' IDENTIFIED BY 'password';
</code></pre>

<p><img src="Images/granting-permissions-in-mysql.png?raw=true" alt="在 MySQL 中授予权限" />
</p>

<p><em>在 MySQL 中授予权限</em></p></li>
<li><p>打开 Internet Explorer 并且找到虚拟机计算机 DNS 名称。浏览到 <em>http://[YOUR-DNS-URL]/drupal</em> 以完成整个 Drupal 安装。</p>

<p><img src="Images/opening-drupal-for-the-first-time.png?raw=true" alt="首次打开 Drupal" />
</p>

<p><em>首次打开 Drupal</em></p>
<blockquote>
<p><strong>注意：</strong>您可以在正式文档中找到与 Drupal 配置有关的更详细信息 (<a href="http://drupal.org/documentation/install/run-script"><a href="http://drupal.org/documentation/install/run-script">http://drupal.org/documentation/install/run-script</a></a>)。</p>
</blockquote></li>
<li><p>在“设置数据库”页中，输入在任务 1（“drupaldb”）中创建的数据库的名称以及<strong>用户名</strong>和<strong>密码</strong>。</p>

<p><img src="Images/opening-drupal-for-the-first-time2.png?raw=true" alt="首次打开 Drupal (2)" />
</p>

<p><em>首次打开 Drupal</em></p></li>
<li><p>在<strong>“配置网站”</strong>网站中，输入用户名、电子邮件地址和密码以便创建一个新的<strong>网站维护帐户</strong>。</p>

<p><img src="Images/configuring-a-drupal-account.png?raw=true" alt="配置 Drupal 帐户" />
</p>

<p><em>配置 Drupal 帐户</em></p></li>
<li><p>单击<strong>“访问您的网站”</strong>链接以便确认 Drupal 主页已加载。</p>

<p><img src="Images/drupal-cms-home-page.png?raw=true" alt="Drupal CMS 主页" />
</p>

<p><em>Drupal CMS 主页</em></p></li>
</ol>

<hr />

<p><a name='Summary'></a></p>

<h2 id="Summary">小结</h2>

<p>在此动手实验中，您已学习了如何使用 Windows Azure IaaS 平台在云中设置基于 Linux 的虚拟机和从远程管理它。</p> </span>
		</div>
	<br/>
	<p><a href="#top">返回页首</a></p>


				</div>
			</section>
			<footer>
				<div class="footer-sitemap" style="border-top:0"></div>
				<div class="footer-bottom">
					<ul>
						<li class="footer-copyright"><a href="http://www.microsoft.com"><img alt="microsoft" src="images/microsoft.png" /></a></li>					
												<li><a href="https://github.com/WindowsAzure-TrainingKit/HOL-IntroToWindowsAzureVirtualMachinesLinux/issues" target="_new">记录问题</a></li>
												<li><a href="mailto:azcfeed@microsoft.com?subject=Windows Azure Training Kit">联系我们</a></li>
						<li><a href="EULA.htm">使用条款</a></li>
						<li><a href=".\">浏览内容</a></li>
						<li>&copy; 2012 Microsoft</li>
					</ul>
				</div>
			</footer>
			</div>
        </div>
    </div>
</body>
</html>

